# Модуль комментариев к книги с использованием WebSockets в NestJS

## API сервера

Сервер с аутентификацией, написанный на языке программирования TypeScript с использованием платформы NestJS, с возможностью использовать в качестве хранилища JSON-файлы или БД Mongo. Поддерживается аутентификация по логину и паролю, а также по токену (JWT).

Код соответствует ВСЕМ (_почти_) требованиям **SOLID**.

__Основные возможности сервера:__
1. Регистрация пользователя (`POST /api/users/signup`).
2. Аутентификация пользователя (`POST /api/users/signin`) - возвращает информацию о залогиненном пользователе
3. Аутентификация пользователя с получением JWT (`POST /api/users/token`) - возвращает JWT.
4. Профиль пользователя (`GET /api/users/profile`) - только после аутентификации (по JWT-токену).
5. Информация о других пользователях (`GET /api/users/{id}`)
6. Получение всех книг (`GET /api/books`).
7. Получение книги по ID (`GET /api/books/{id}`)
8. Создание книги (`POST /api/books`).
9. Обновление книги с идентификатором ID (`PUT /api/books/{id}`).
10. Удаление книги с идентификатором ID (`DELETE /api/books/{id}`)
11. Получение всех комментариев к книгам (`GET /api/comments`).
12. Получение одного комментария по ID (`GET /api/comments/{id}`)
13. Получение всех комментариев для конкретной книги (`GET /api/comments/book/{id}`)
14. Создание комментария к книге ID (`POST /api/comments/{bookId}`).
15. Обновление комментария с идентификатором ID (`PUT /api/comments/{id}`).
16. Удаление комментария с идентификатором ID (`DELETE /api/comments/{id}`)
17. _(дополнительно)_ Получение всех настроек (переменных окружения) (`GET /config`)
18. _(дополнительно)_ Получение значения переменной окружения по имени (`GET /config/{variable}`)
 


## Модули

В приложении реализованы следующие модули:
1. `CONFIG` ([src/modules/config/config.module.ts](src/modules/config/config.module.ts)) - настройки функционирования приложения.
2. `USERS`  ([src/modules/users/users.module.ts](src/modules/users/users.module.ts)) - работа с пользователями (добавление, хранение, запросы).
3. `AUTH`  ([src/modules/auth/auth.module.ts](src/modules/auth/auth.module.ts)) - аутентификация пользователей и формирование JWT.
4. `BOOKS` ([src/modules/books/books.module.ts](src/modules/books/books.module.ts)) - работа с книгами (добавление, хранение, запросы).
5. `BOOKCOMMENTS` ([src/modules/bookcomments/bookcomments.module.ts](src/modules/bookcomments/bookcomments.module.ts)) - работа с комментариями к книгами (добавление, хранение, запросы).
6. `APP`  ([src/app.module.ts](src/app.module.ts)) - само приложение.


Подробная информация про модули описана тут - ([https://github.com/mea2k/BookStor/tree/main/Jest](https://github.com/mea2k/BookStor/tree/main/Jest#readme))



## Запуск

### Переменные окружения

Все необходимые параметры приложения задаются в переменных окружения:
- [.env](.env) - полный формат всех переменных окружения
- [mongo.env](mongo.env) - настройки для работы с БД Mongo
- [file.env](file.env) - настройки для работы с JSON-файлами

Файл сборки всех контейнеров - [Docker-compose.yml](Docker-compose.yml).

Файл сборки контейнера `book-comments` - [Dockerfile](Dockerfile).

Сам контейнер доступен по ссылке: [https://hub.docker.com/repository/docker/makevg/book-comments/general](https://hub.docker.com/repository/docker/makevg/book-comments/general).



## Запуск локально с использованием файлового хранилища и с поддержкой web-сокетов

Для запуска сервера локально без использования контейнеров необходимо выполнить команду:
- для режима отладки `npm run watch`
- для основного режима `npm run build` и потом `npm run start` 



## Проверка работы

### Проверка API

Для проверки работоспособности можно воспользоваться:
1. Программой `PostMan`.
2. Программной `curl`.
3. Файлом [requests.http](requests.http) в среде VSCode с установленным расширением `REST Client`.

### Проверка web-сокетов

Для проверки web-сокетов была разработана web-страница ([public/index.html](public/index.html)).
Порядок действий:
1. Запустить backend-сервер (`npm run start`).
2. Открыть в браузере web-страницу [public/index.html](public/index.html) в 2-х вкладках.
3. Зарегистрировать пользователя (заполнить поля, нажать кнопку `Зарегистрироваться`).
4. После успешной регистрации получить токен аутентификации (заполнить логин, пароль, нажать кнопку `Получить токен`).
5. Добавить несколько книг (заполнить поля, нажать кнопку `КНИГИ-->Добавить` в разделе 'КНИГИ').
6. Добавить несколько комментариев к разным книгам (заполнить поля формы и нажать кнопку `КОММЕНТАРИИ-->Добавить`, ID книги взять из п.5).
7. Посмотреть все комментарии можно по кнопке `Список комментариев`. Если поле `ID книги` заполнено, вернутся комментарии указанной книги, если не заполнено - вернуться все комментарии.
8. Включить web-сокеты кнопкой `Подключить web-сокет`.
9. Еще раз добавить комментарий к книге из п.5. Проанализировать содержимое поля `Все комментарии (WS)` на всех открытых вкладках web-страницы.











# Задание
[https://github.com/netology-code/ndtnf-homeworks/tree/master/016-websocket-NESTJS](https://github.com/netology-code/ndtnf-homeworks/tree/master/016-websocket-NESTJS)
