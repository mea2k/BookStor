# КОЛЛЕКЦИЯ КНИГ - RESTful backend server (CRUD API)

## Описание

Сервер "Коллекция книг" предоставляет следующие возможности (API):
1. Получение списка хранимых книг (`GET /api/books`).
2. Получение информации об отдельной книге (`GET /api/books/:id`).
3. Добавление книги в коллекцию (`POST /api/books`).
4. Изменение информации о книге из коллекции (`PUT /api/books/:id`).
5. Удаление книги из коллекции (`DELETE /api/books/:id`).


## БД MONGODB

Для хранения книг используется БД MongoDB, которая запускается из контейнеров.
Файл запуска - [Docker-compose.yml](Docker-compose.yml).

Используеиые библиотеки - *mongoose*.

## Модель *КНИГА* ([models/books.js](src/models/books.js))


Модель "Книга" реализована в файле [src/models/books.js](src/models/books.js).

Атрибуты сущности:

`title` - название книги (`String`),

`description` - описание книги (`String`),

`authors` - авторы книги (`String`),

`favorite` - жанр книги (`String`),

`fileCover` - имя файла с картинкой обложки (`String`),

`fileName` - имя файла с текстом (`String`),

`_id` - внутренний идентификатор книги (используется внутри системы, назначается автоматически)
 

 

## Маршруты ([routes](src/routes))


### Пути `/api/books` ([src/routes/books.js](src/routes/books.js))

`GET /api/books` - получение списка книг ([код](src/routes/books.js#L19)). Возвращает массив объектов типа Book `[{...}, {...}, ...]`. Код успеха - 200.

`GET /api/books/:id` - получение информации о книге с идентификатором `id` ([код](src/routes/books.js#L43)). Возвращает объект типа Book. Код успеха - 200. Код ошибки - 404.

`POST /api/books` - добавление новой книги ([код](src/routes/books.js#L73)). В теле запроса должен быть JSON-объект со значениями параметров книги (`{title,description,authors,favorite,fileCover,fileName}`), а также сам файл, который загружается на сервер (`fileBook`) и его оригинальное имя (`fileName`). Возвращает саму добавленную книгу - объект класса Book. Код успеха - 201. Код ошибки - 403.

`PUT /api/books/:id` - редактирование информации о книги с идентификатором `id` ([код](src/routes/books.js#L131)). В теле запроса должен быть JSON-объект с новыми значениями параметров книги (`{title,description,authors,favorite,fileCover,fileName}`). Возвращает измененную информацию о книге - объект класса Book. Код успеха - 200. Код ошибки - 404.

`DELETE /api/books/:id` - удаление книги с идентификатором `id` ([код](src/routes/books.js#L181)). Возвращает 'ok' или пусто. Код успеха - 200. Код ошибки - 404.


## Промежуточные обработчики ([middleware](src/middleware))


### Обработка страницы 404 ([middleware/err404.js](src/middleware/err404.js))
Все пути, не указанные для обработки переводятся на страницу 404.

Возвращаемый код - 404.

Возвращаемый текст: `Страница ${url} не найдена`.

### Обработка загрузки файлов ([middleware/fileMulter.js](src/middleware/fileMulter.js))
Для загрузки фалов используется библиотека `Multer`. Обработчик сохрняет загружаемые файлы в папке `public/fileBook`.

Имя файлов - `ID_DATE.ext`.



## Основной файл ([index.js](src/index.js))

Основной код сервера реализован в файле [index.js](src/index.js). Используется библиотека `Express` для запуска сервера. Все параметры передаются в теле запросов в виде JSON-объектов, результат работы методов - JSON-данные.

Используется библиотека `Mongoose` для работы с БД MongoDB.

### Инициализация Mongo
В файле [mongo-init.js](mongo-init.js) содержится сценарий, создающий БД `Bookstore` и коллекцию `Books`. ТАкже создается пользователь `user:user` для работы с БД `Bookstore`. Данный сценарий выполняется один раз при первом запуске контейнера mongo.





## Запуск

### Запуск рабочей версии

1. Создать папку для хранения данных (например, `mongo/data`).
2. В файле [docker-compose.yml](docker-compose.yml) для контейнера __mongo__  указать монтируемый путь /`data/db` на созданную в п.1 папку: `./mongo/data:/data/db`
3. В файле [docker-compose.yml](docker-compose.yml) для контейнера __mongo__  задать порт проброса с хоста (например, `ports: [ 27017:27017 ]`).
5. Выполнить команду
```
docker compose up
```
